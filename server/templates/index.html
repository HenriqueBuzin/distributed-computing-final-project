<!DOCTYPE html>
<html>
<head>
    <title>Flask Docker Communication</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Flask Docker Communication</h1>

    <h2>Criar Novo Container</h2>
    <button id="create-container">Criar Container</button>

    <h2>Lista de Nós</h2>
    <ul id="node-list"></ul>

    <h2>Enviar Mensagem</h2>
    <form id="message-form">
        <label for="origin">Nó de Origem:</label>
        <select id="origin" name="origin"></select>

        <label for="destination">Nó de Destino:</label>
        <select id="destination" name="destination"></select>

        <label for="message">Mensagem:</label>
        <input type="text" id="message" name="message">

        <button type="submit">Enviar</button>
    </form>

    <script>
        $(document).ready(function() {
            // Função para atualizar a lista de nós
            function updateNodeList() {
                $.getJSON('/get-nodes', function(data) {
                    var nodeList = $('#node-list');
                    nodeList.empty();

                    $.each(data, function(index, node) {
                        nodeList.append('<li>' + node + '</li>');
                    });

                    // Atualizar as opções do formulário de envio de mensagem
                    var originSelect = $('#origin');
                    var destinationSelect = $('#destination');
                    originSelect.empty();
                    destinationSelect.empty();

                    $.each(data, function(index, node) {
                        originSelect.append('<option value="' + node + '">' + node + '</option>');
                        destinationSelect.append('<option value="' + node + '">' + node + '</option>');
                    });
                });
            }

            // Atualizar a lista de nós ao carregar a página
            updateNodeList();

            // Criar um novo contêiner ao clicar no botão
            $('#create-container').on('click', function() {
                $.getJSON('/create-container', function(data) {
                    console.log(data.message);
                    updateNodeList();
                });
            });

            // Enviar mensagem ao contêiner de destino ao enviar o formulário
            $('#message-form').on('submit', function(e) {
                e.preventDefault();
                var origin = $('#origin').val();
                var destination = $('#destination').val();
                var message = $('#message').val();

                $.ajax({
                    url: '/send-message',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        origin: origin,
                        destination: destination,
                        message: message
                    }),
                    success: function(data) {
                        console.log('Mensagem enviada com sucesso!');
                        $('#message-form')[0].reset();
                    }
                });
            });
        });
    </script>
</body>
</html>
