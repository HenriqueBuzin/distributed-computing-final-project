<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>

    <script>
        $(document).ready(function() {
            function createNode() {
                $.ajax({
                    url: '/node',
                    type: 'POST',
                    success: function(response) {
                        console.log('Nó criado:', response);
                        getNodes(); // Atualiza a lista de nós após criar um novo nó
                    },
                    error: function(error) {
                        console.log('Erro ao criar nó:', error);
                    }
                });
            }

            function getNodes() {
                $.ajax({
                    url: '/graph',
                    type: 'GET',
                    success: function(response) {
                        console.log('Lista de nós:', response);
                        // Atualize a interface do usuário com a lista de nós
                        $('#node-list').empty();
                        $('#recipient').empty(); // Limpa as opções antes de adicionar novamente
                        $('#recipient').append($('<option>', {
                            value: 'broadcast',
                            text: 'Broadcast'
                        }));
                        response.forEach(function(node) {
                            $('#node-list').append('<li>' + node.node_id + '</li>');
                            $('#recipient').append($('<option>', {
                                value: node.node_id,
                                text: 'Nó ' + node.node_id
                            }));
                        });
                    },
                    error: function(error) {
                        console.log('Erro ao obter nós:', error);
                    }
                });
            }

            $('#create-node-btn').click(function() {
                createNode();
            });

            getNodes(); // Obtém a lista de nós inicial quando a página é carregada
        });
    </script>

    <title>Hello, world!</title>

  </head>
  <body>
    <div class="container">
      <h1>Lista de Nós</h1>
      <button id="create-node-btn">Criar Nó</button>
      <ul id="node-list"></ul>

      <form id="send-message-form">
        <label for="recipient">Destinatário:</label>
        <select id="recipient">
            <option value="broadcast">Broadcast</option>
            <!-- Opções de nós serão adicionadas dinamicamente -->
        </select>

        <br>

        <label for="message">Mensagem:</label>
        <input type="text" id="message" required>

        <br>

        <button type="submit">Enviar</button>
      </form>
    </div>
  </body>
</html>